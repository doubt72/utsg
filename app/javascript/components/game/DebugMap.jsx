import React, { useEffect, useState } from "react";
import { Map } from "../../engine/map";
import MapHex from "./MapHex";
import MapHexOverlay from "./MapHexOverlay";
import MapHexPatterns from "./MapHexPatterns";

export default function GameMap() {
  const [hexes, setHexes] = useState([])
  const [overlays, setOverlays] = useState([])

  const map = new Map({
    layout: [15, 15, "x"],
    hexes: [
      [
        { t: "s", e: "all" },
        { t: "s", e: [1, 1, 0, 1, 1, 1], r: { d: [2, 5], t: "d" } },
        { t: "s", e: [1, 0, 0, 0, 0, 1] },
        { t: "o", r: { d: [3, 6], t: "d" } },
        { t: "f", e: [0, 0, 0, 0, 1, 1] },
        { t: "o" },
        { t: "o" },
        { t: "o" },
        { t: "o", b: "b", be: [1] },
        { t: "o" },
        { t: "o", r: { d: [2, 6], t: "t", c: "l" } },
        { t: "o", b: "w", be: [1] },
        { t: "o" },
        { t: "o" },
        { t: "o" },
      ], [
        { t: "s", e: [1, 1, 1, 1, 0, 0] },
        { t: "s", e: [1, 1, 1, 0, 0, 0], r: { d: [2, 4], t: "d" } },
        { t: "o", r: { d: [1, 3, 5], t: "d" } },
        { t: "f", e: [0, 0, 1, 1, 0, 0] },
        { t: "f", e: [1, 1, 0, 0, 0, 0] },
        { t: "o" },
        { t: "o", b: "b", be: [2, 3] },
        { t: "o", b: "b", be: [2, 3], st: { sh: "c", d: 5 } },
        { t: "o", b: "b", be: [1, 2], st: { sh: "s", s: "f", d: 2 } },
        { t: "o", r: { d: [3, 5], t: "t", c: "r" } },
        { t: "o", b: "w", be: [1,2 ], st: { sh: "x", d: 1 } },
        { t: "o" },
        { t: "o" },
        { t: "o" },
        { t: "o" },
      ], [
        { t: "w", e: [1, 0, 0, 1, 1, 1] },
        { t: "w", e: [1, 0, 0, 0, 0, 1] },
        { t: "f" },
        { t: "o", r: { d: [2, 5], t: "d" } },
        { t: "b", e: [0, 0, 0, 1, 0, 0] },
        { t: "b", e: [1, 0, 0, 0, 0, 0] },
        { t: "o" },
        { t: "d" },
        { t: "d" },
        { t: "o", st: { sh: "s", s: "f", d: 5 } },
        { t: "o", r: { d: [2, 4, 6], t: "t", c: "l" }, b: "w", be: [3] },
        { t: "o", r: { d: [1, 4], t: "t" }, b: "w", be: [2, 3] },
        { t: "o", r: { d: [1, 4], t: "t" }, b: "w", be: [2, 3] },
        { t: "o", r: { d: [1, 4], t: "t" }, b: "w", be: [2, 3] },
        { t: "o", r: { d: [1, 4], t: "t" }, b: "w", be: [2, 3] },
      ], [
        { t: "w", e: [1, 1, 1, 0, 0, 1], s: { d: [1, 4] } },
        { t: "o", s: { d: [1, 5] } },
        { t: "o" },
        { t: "o", r: { d: [2, 5], t: "d" } },
        { t: "f", e: [0, 0, 0, 1, 1, 0] },
        { t: "f", e: [1, 0, 0, 0, 1, 1], r: { t: "p", d: [4, 6] } },
        { t: "o" },
        { t: "g", e: [0, 0, 0, 1, 1, 0], b: "f", be: [1, 2, 3] },
        { t: "g", e: [1, 0, 0, 0, 1, 1], b: "f", be: [2, 3] },
        { t: "o", r: { d: [3, 5], t: "t", c: "r" }, b: "f", be: [1] },
        { t: "o", st: { sh: "s", d: 1 } },
        { t: "o", st: { sh: "m", d: 1 } },
        { t: "o", st: { sh: "s", d: 4 } },
        { t: "o", st: { sh: "x", s: "f", d: 2 } },
        { t: "o" },
      ], [
        { t: "w", e: [1, 1, 1, 0, 0, 1] },
        { t: "b" },
        { t: "o", s: { d: [2, 6] } },
        { t: "o" },
        { t: "o", r: { d: [2, 5], t: "d" } },
        { t: "f", e: [0, 1, 1, 1, 1, 0], r: { t: "p", d: [1, 3] } },
        { t: "f", e: [1, 1, 0, 0, 0, 1] },
        { t: "o", b: "f", be: [3] },
        { t: "g", e: [0, 1, 1, 1, 0, 0], b: "f", be: [1] },
        { t: "g", e: [1, 1, 0, 0, 0, 0], b: "f", be: [3] },
        { t: "o", r: { d: [2, 6], t: "t", c: "l" }, b: "f", be: [1] },
        { t: "o", st: { sh: "s", d: 1 } },
        { t: "o", st: { sh: "s", d: 4 } },
        { t: "o", st: { sh: "l", d: 1 } },
        { t: "o" },
      ], [
        { t: "m", e: [0, 0, 0, 1, 0, 0] },
        { t: "m", e: [1, 0, 0, 1, 1, 0], s: { d: [3, 4] } },
        { t: "m", e: [1, 0, 0, 0, 0, 1], s: { d: [1, 5] } },
        { t: "b", e: [0, 0, 0, 0, 1, 0] },
        { t: "o", r: { d: [2, 5], t: "d" } },
        { t: "f", e: [0, 1, 1, 0, 1, 0] },
        { t: "o" },
        { t: "o", b: "f", be: [3] },
        { t: "o", r: { d: [4, 6], t: "d" }, b: "f", be: [2, 3] },
        { t: "o", r: { d: [1, 3, 4], t: "t", c: "r" }, b: "f", be: [2] },
        { t: "o", r: { d: [1, 4], t: "t" } },
        { t: "o", r: { d: [1, 4], t: "t" } },
        { t: "o", r: { d: [1, 4], t: "t" } },
        { t: "o", r: { d: [1, 4], t: "t" } },
        { t: "o", r: { d: [1, 4], t: "t" }, s: { d: [3, 5] } },
      ], [
        { t: "o" },
        { t: "w" },
        { t: "m", e: [0, 1, 1, 0, 0, 0] },
        { t: "o", s: { d: [2, 5] } },
        { t: "b", e: [0, 1, 0, 0, 0, 0] },
        { t: "o", r: { d: [2, 5], t: "d" } },
        { t: "f", e: [0, 1, 0, 0, 0, 0] },
        { t: "o" },
        { t: "o", r: { d: [3, 6], t: "d" } },
        { t: "f", e: [0, 0, 0, 1, 1, 1] },
        { t: "f", e: [1, 0, 0, 0, 1, 1] },
        { t: "o", st: { sh: "l", d: 2 } },
        { t: "o", st: { sh: "l", d: 3 } },
        { t: "o", st: { sh: "s", d: 3 } },
        { t: "o" },
      ], [
        { t: "o", r: { d: [1, 4], t: "d" } },
        { t: "o", r: { d: [1, 4], t: "d" } },
        { t: "o", r: { d: [1, 4], t: "d" } },
        { t: "o", s: { d: [2, 5] }, r: { d: [1, 4], t: "d" } },
        { t: "o", r: { d: [1, 4], t: "d" } },
        { t: "o", r: { d: [1, 2, 4], t: "d" } },
        { t: "o", r: { d: [1, 4], t: "d" } },
        { t: "o", r: { d: [1, 3, 5], t: "d" } },
        { t: "f", e: [0, 0, 1, 1, 1, 0] },
        { t: "f", e: "all" },
        { t: "f", e: [1, 1, 0, 0, 0, 1] },
        { t: "o" },
        { t: "o", st: { sh: "s", d: 6 } },
        { t: "o" },
        { t: "o" },
      ], [
        { t: "o" },
        { t: "o" },
        { t: "j" },
        { t: "o", h: 1, he: [0, 0, 0, 0, 0, 1] },
        { t: "o", s: { d: [2, 6] } },
        { t: "j", e: [0, 0, 0, 1, 1, 0] },
        { t: "j", e: [1, 0, 0, 0, 1, 1] },
        { t: "o" },
        { t: "o", r: { d: [2, 4], t: "d" } },
        { t: "f", e: [0, 1, 1, 1, 1, 0], r: { d: [1, 4], t: "d" } },
        { t: "f", e: [1, 1, 1, 0, 0, 1], r: { d: [1, 5], t: "d" } },
        { t: "o" },
        { t: "o", h: 1, he: [0, 0, 0, 1, 1, 1] },
        { t: "o", h: 1, he: [1, 0, 0, 1, 1, 1] },
        { t: "o", h: 1, he: [1, 0, 0, 1, 1, 1] },
      ], [
        { t: "o" },
        { t: "o", h: 1, he: [0, 0, 0, 1, 1, 1] },
        { t: "o", h: 1, he: [1, 0, 1, 0, 1, 1] },
        { t: "o", s: { d: [3, 5] } },
        { t: "o" },
        { t: "j", e: [0, 1, 1, 1, 0, 0] },
        { t: "j", e: [1, 1, 0, 0, 0, 0], h: 1, he: [0, 0, 0, 1, 1, 1] },
        { t: "o", h: 1, he: [1, 0, 0, 1, 1, 1] },
        { t: "o", h: 1, he: [1, 0, 0, 1, 1, 1] },
        { t: "f", e: [0, 1, 1, 0, 0, 0], h: 1, he: [1, 0, 0, 1, 1, 1] },
        { t: "o", h: 1, he: [1, 0, 0, 1, 1, 1], r: { d: [2, 5], t: "d" } },
        { t: "o", h: 1, he: [1, 0, 1, 1, 1, 1] },
        { t: "f", e: [0, 0, 0, 0, 0, 1], h: 1, he: "all" },
        { t: "o", h: 1, he: "all" },
        { t: "o", h: 2, he: [0, 0, 0, 1, 1, 1] },
      ], [
        { t: "o", h: 1, he: [1, 1, 0, 1, 1, 1] },
        { t: "o", h: 1, he: [1, 0, 1, 1, 1, 1] },
        { t: "o", h: 2 },
        { t: "o", h: 1, he: [1, 1, 0, 0, 1, 1] },
        { t: "o", s: { d: [2, 5] } },
        { t: "o", h: 1, he: [0, 0, 0, 1, 1, 0] },
        { t: "o", h: 1, he: [1, 0, 1, 1, 1, 1] },
        { t: "o", h: 1, he: "all" },
        { t: "o", h: 1, he: "all" },
        { t: "o", h: 2, he: [0, 0, 0, 1, 1, 1] },
        { t: "o", h: 2, he: [1, 0, 0, 0, 1, 1] },
        { t: "o", h: 1, he: "all", r: { d: [2, 6], t: "d" } },
        { t: "f", e: [0, 0, 1, 0, 0, 1], h: 2, he: [0, 0, 0, 1, 1, 1] },
        { t: "o", h: 2, he: [1, 0, 0, 1, 1, 1] },
        { t: "o", h: 2, he: [1, 0, 1, 1, 1, 1] },
      ], [
        { t: "o", h: 1, he: "all" },
        { t: "o", h: 1, he: "all" },
        { t: "o", h: 1, he: "all" },
        { t: "o", h: 2, he: [0, 0, 1, 1, 1, 1], b: "c", be: [3] },
        { t: "o", s: { d: [2, 5] }, b: "c", be: [1] },
        { t: "o", h: 2, he: [1, 0, 0, 1, 1, 1], b: "c", be: [1] },
        { t: "o", h: 2, he: [1, 0, 0, 1, 1, 1] },
        { t: "o", h: 2, he: [1, 0, 0, 1, 1, 1] },
        { t: "o", h: 2, he: [1, 0, 1, 1, 1, 1] },
        { t: "o", h: 2, he: "all" },
        { t: "o", h: 2, he: [1, 1, 0, 1, 1, 1], r: { d: [3, 6], t: "d" } },
        { t: "f", e: [0, 0, 1, 0, 0, 0], h: 2, he: [1, 0, 1, 1, 1, 1] },
        { t: "o", h: 2, he: "all" },
        { t: "f", e: [0, 0, 0, 0, 1, 1], h: 3, he: [0, 0, 0, 1, 1, 1] },
        { t: "o", h: 3, he: [1, 0, 1, 1, 1, 1] },
      ], [
        { t: "o", h: 1, he: "all" },
        { t: "o", h: 1, he: "all" },
        { t: "b", e: [0, 0, 0, 0, 1, 0], h: 2, he: [0, 0, 0, 1, 1, 1] },
        { t: "o", h: 2, he: [1, 0, 1, 1, 1, 1] },
        { t: "o", h: 2, he: "all", b: "c", be: [3] },
        { t: "o", s: { d: [2, 6] }, b: "c", be: [1, 3]  },
        { t: "o", h: 2, he: "all", b: "c", be: [1] },
        { t: "o", h: 3, he: [0, 0, 0, 1, 1, 1] },
        { t: "o", h: 3, he: [1, 0, 0, 1, 1, 1] },
        { t: "o", h: 3, he: [1, 0, 0, 1, 1, 1] },
        { t: "o", h: 3, he: [1, 0, 0, 1, 1, 1], r: { d: [3, 5], t: "d" } },
        { t: "o", h: 3, he: [1, 0, 0, 1, 1, 1] },
        { t: "o", h: 3, he: [1, 0, 0, 1, 1, 1] },
        { t: "f", e: [0, 0, 1, 1, 0, 0], h: 3, he: [1, 0, 1, 1, 1, 1] },
        { t: "f", e: [1, 1, 0, 0, 0, 0], h: 3, he: "all" },
      ], [
        { t: "o", h: 2, he: [1, 0, 0, 1, 1, 1] },
        { t: "o", h: 2, he: [1, 0, 1, 1, 1, 1] },
        { t: "b", e: [0, 1, 0, 0, 0, 1], h: 2, he: "all" },
        { t: "o", h: 3, he: [0, 0, 0, 1, 1, 1] },
        { t: "o", s: { d: [3, 6] }, b: "c", be: [1, 2] },
        { t: "o", h: 3, he: [1, 1, 0, 1, 1, 1], b: "c", be: [1, 2] },
        { t: "o", h: 3, he: [1, 0, 1, 1, 1, 1] },
        { t: "o", h: 3, he: "all" },
        { t: "o", h: 3, he: "all" },
        { t: "o", h: 3, he: "all" },
        { t: "o", h: 3, he: "all", r: { d: [2, 5], t: "d" } },
        { t: "o", h: 4, he: [0, 0, 0, 1, 1, 1] },
        { t: "o", h: 4, he: [1, 0, 0, 1, 1, 1] },
        { t: "o", h: 4, he: [1, 0, 0, 1, 1, 1] },
        { t: "o", h: 4, he: [1, 0, 0, 1, 1, 1] },
      ], [
        { t: "o", h: 2, he: "all" },
        { t: "o", h: 2, he: "all" },
        { t: "b", e: [0, 0, 1, 0, 0, 0], h: 2, he: "all" },
        { t: "o", h: 3, he: [0, 0, 1, 1, 1, 1] },
        { t: "o", h: 1, he: [1, 1, 0, 1, 1, 1], s: { d: [3, 5] }, b: "c", be: [1, 2] },
        { t: "o", h: 3, he: "all", b: "c", be: [1, 2] },
        { t: "o", h: 3, he: "all" },
        { t: "o", h: 4, he: [0, 0, 0, 0, 1, 1] },
        { t: "o", h: 3, he: "all" },
        { t: "o", h: 4, he: [0, 0, 0, 1, 1, 1] },
        { t: "o", h: 4, he: [1, 0, 0, 1, 1, 1] },
        { t: "o", h: 4, he: [1, 0, 1, 1, 1, 1], r: { d: [2, 5], t: "d" } },
        { t: "o", h: 4, he: "all" },
        { t: "o", h: 5, he: [0, 0, 0, 1, 1, 1] },
        { t: "o", h: 5, he: [1, 0, 0, 1, 1, 1] },
      ]
    ]
  })

  useEffect(() => {
    const hexLoader = []
    const overlayLoader = []
    map.mapHexes.forEach((row, y) => {
      row.forEach((hex, x) => {
        hexLoader.push(<MapHex key={`${x}-${y}`} hex={hex}/>)
        overlayLoader.push(<MapHexOverlay key={`${x}-${y}-o`} hex={hex}/>)
      })
    })
    setHexes(hexLoader)
    setOverlays(overlayLoader)
  }, [])

  const hexNarrow = 96
  const hexWide = hexNarrow / 2 / Math.sin(1/3 * Math.PI) * 1.5
  const width = hexNarrow * ((map.width || 0) + 0.5) + 2
  const height = hexWide * ((map.height || 0) + 0.3333) + 2

  return (
    <div className="map-container">
      <svg className="map-svg" width={width} height={height}
           viewBox={`0 0 ${width} ${height}`}>
        <MapHexPatterns />
        {hexes}
        {overlays}
      </svg>
    </div>
  )
}